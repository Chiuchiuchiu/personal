<style>
    .form-control {
        margin:0 40% 10px 41%;width:210px;background:rgba(0, 0, 0, 0);
    }
</style>
<div style="background:#262626">
    <div class="fh5co-features-style-2">
        <div class="container">
            <div class="row p-b">
                <div class="col-md-6 col-md-offset-3 text-center">
                    <h2 class="fh5co-heading wow fadeInUp" style="color: #fff;">Sign Up</h2>
                    <p class="wow fadeInUp" ><i class="icon icon-user"></i> 注册 <i class="icon icon-user"></i></p>
                </div>
            </div>
            <form id="register" >
                <input class="form-control wow fadeInUp" type="text" placeholder="请输入昵称" name="username"/>
                <input class="form-control wow fadeInUp" type="password" name="password" placeholder="请输入密码"/>
                <input class="form-control wow fadeInUp" type="text" name="phone" placeholder="请输入手机"/>
                <input class="form-control wow fadeInUp" type="text" name="mail" placeholder="请输入邮箱"/>
                <button class="form-control btn btn-primary btn-sm btn-outline wow fadeInUp" id="btn"/>获取验证码</button>
                <input class="form-control wow fadeInUp" type="text" name="verify" placeholder="请输入验证码"/>
                <div class="col-md-6 col-md-offset-3 text-center">
                    <button class="btn btn-success btn-sm btn-outline wow fadeInUp" type="submit">注册</button>
                    <a href="{:U('Index/index')}" class="btn btn-success btn-sm btn-outline wow fadeInUp" >返回首页</a>
                </div>
                <div class="col-md-6 col-md-offset-3 text-center wow fadeInUp">
                    <label style="font-size: small"><span>已经拥有帐户?</span> <a href="{:U('SignUp/login')}">登录</a> <i class="icon icon-hand-o-right"></i></label>
                </div>
                <!--<div class="col-md-6 col-md-offset-3 text-center" >-->
                    <!--昵称：-->
                    <!--<input type="text" name="username" placeholder="请输入昵称"/>-->
                <!--</div>-->
                <!--<div class="col-md-6 col-md-offset-3 text-center" >-->
                    <!--<input type="password" name="password" placeholder="请输入密码"/>-->
                <!--</div>-->
                <!--<div class="col-md-6 col-md-offset-3 text-center" >-->
                    <!--<input type="text" name="phone" placeholder="请输入手机"/>-->
                <!--</div>-->
                <!--<div class="col-md-6 col-md-offset-3 text-center" >-->
                    <!--<input type="text" name="mail" placeholder="请输入邮箱"/>-->
                    <!--<input type="button" id="btn" value="获取验证码" />-->
                <!--</div>-->
                <!--<div class="col-md-6 col-md-offset-3 text-center" >-->
                    <!--<label></label>-->
                    <!--<input type="text" name="verify" placeholder="请输入验证码"/>-->
                <!--</div>-->
                <!--<button type="submit">注册</button>-->
            </form>
        </div>

    </div>
</div>
</body>
</html>
<script src="__PUBLIC__/js/layer/layer.js"></script>
<script type="text/javascript">
    $(function () {
        var nick_name = $("input[name='username']");
        var password = $("input[name='password']");
        var email = $("input[name='mail']");
        var verify = $("input[name='verify']");
        var phone = $("input[name='phone']");

        $('#btn').click(function () {
            //发送验证码，先正则检验邮箱
            var reg = /^\w+([-+.]\w+)*@\w+([-.]\w+)*\.\w+([-.]\w+)*$/;
            if(!reg.test(email.val())){
                email.focus();
                layer.msg('请输入正确的邮箱...');
                return;
            }

            //开启loading
            layer.load(2);
            $.get("{:U('Home/SignUp/send_verify')}", {mail:email.val()}, function(re){
                layer.closeAll('loading');  //关闭loading
                if(re.code == 20000){
                    layer.msg("验证码已发送到您的电子邮箱 >3< ", {time:3000});

                    var count = 60;
                    var countdown = setInterval(function(){
                        $("#btn").attr("disabled", true);

                        $("#btn").val(count + "秒后失效");
                        if (count == 0) {
                            $("#btn").val("发送验证码").removeAttr("disabled");
                            clearInterval(countdown);
                        }
                        count--;
                    }, 1000);
                }else{
                    layer.msg(re.msg);
                    return false;
                }
            });
        });

        $("#register").submit(function(){
            //提交注册
            if(!nick_name.val()){
                nick_name.focus();
                layer.msg('昵称呢??');
                return false;
            }
            if(!password.val()){
                password.focus();
                layer.msg('密码呢??');
                return false;
            }
            if(!phone.val()){
                phone.focus();
                layer.msg('手机号呢??');
                return false;
            }
            if(!email.val()){
                email.focus();
                layer.msg('邮箱呢??');
                return false;
            }
            if(!verify.val()){
                verify.focus();
                layer.msg('验证码呢??');
                return false;
            }

            $.ajax({
                url: "{:U('Home/SignUp/register')}",
                type: "POST",
                dataType: "json",
                data: {
                    nick_name:nick_name.val(),
                    password:password.val(),
                    email:email.val(),
                    phone:phone.val(),
                    verify:verify.val()
                },
                success:function(res){
                    if(res.code == 20000){
                        layer.msg(res.msg, {icon: 6, time: 3000}, function(){
                            location.href="{:U('Home/Index/Index')}";
                        });

                    }else{
                        layer.msg(res.msg, {icon: 5});
                    }
                },
                error: function(){
                    layer.msg('发生了一丁丁错误...', {icon: 5});
                }
            });
            return false;
        })
    });
</script>